<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Xu Haiyang">
<meta name="dcterms.date" content="2024-09-23">

<title>Take-Home Exercise 2 – IS415 - Xu Haiyang</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415 - Xu Haiyang</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex01/In-class_Ex01-v2.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex01/Take-Home_Ex01.html">
 <span class="dropdown-text">Take-Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-Home_Ex/Take-Home_Ex02/Take-Home_Ex02.html">
 <span class="dropdown-text">Take-Home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setting-the-scene" id="toc-setting-the-scene" class="nav-link active" data-scroll-target="#setting-the-scene"><strong>1. Setting the Scene</strong></a>
  <ul class="collapse">
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives"><strong>1.1 Objectives</strong></a></li>
  <li><a href="#the-task" id="toc-the-task" class="nav-link" data-scroll-target="#the-task"><strong>1.2 The Task</strong></a></li>
  </ul></li>
  <li><a href="#literature-review" id="toc-literature-review" class="nav-link" data-scroll-target="#literature-review"><strong>2. Literature Review</strong></a>
  <ul class="collapse">
  <li><a href="#spatial-autocorrelation" id="toc-spatial-autocorrelation" class="nav-link" data-scroll-target="#spatial-autocorrelation"><strong>2.1 Spatial Autocorrelation</strong></a></li>
  <li><a href="#emerging-hotspot-analysis" id="toc-emerging-hotspot-analysis" class="nav-link" data-scroll-target="#emerging-hotspot-analysis"><strong>2.2 Emerging Hotspot Analysis</strong></a></li>
  </ul></li>
  <li><a href="#importing-packages" id="toc-importing-packages" class="nav-link" data-scroll-target="#importing-packages"><strong>3. Importing Packages</strong></a></li>
  <li><a href="#importing-datasets-to-r-environment" id="toc-importing-datasets-to-r-environment" class="nav-link" data-scroll-target="#importing-datasets-to-r-environment"><strong>4. Importing Datasets to R Environment</strong></a>
  <ul class="collapse">
  <li><a href="#visualizing-the-map-of-thailands-provinces" id="toc-visualizing-the-map-of-thailands-provinces" class="nav-link" data-scroll-target="#visualizing-the-map-of-thailands-provinces"><strong>4.1 Visualizing the Map of Thailand’s Provinces</strong></a></li>
  <li><a href="#projecting-and-adding-geometric-attributes" id="toc-projecting-and-adding-geometric-attributes" class="nav-link" data-scroll-target="#projecting-and-adding-geometric-attributes"><strong>4.2 Projecting and Adding Geometric Attributes</strong></a></li>
  </ul></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing"><strong>5. Data Preprocessing</strong></a>
  <ul class="collapse">
  <li><a href="#exploring-the-data" id="toc-exploring-the-data" class="nav-link" data-scroll-target="#exploring-the-data"><strong>5.1 Exploring the Data</strong></a></li>
  <li><a href="#summarizing-and-visualizing-drug-offense-data" id="toc-summarizing-and-visualizing-drug-offense-data" class="nav-link" data-scroll-target="#summarizing-and-visualizing-drug-offense-data"><strong>5.2 Summarizing and Visualizing Drug Offense Data</strong></a></li>
  <li><a href="#trends-for-top-drug-offenses" id="toc-trends-for-top-drug-offenses" class="nav-link" data-scroll-target="#trends-for-top-drug-offenses"><strong>5.3 Trends for Top Drug Offenses</strong></a></li>
  </ul></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><strong>6. Data Wrangling</strong></a>
  <ul class="collapse">
  <li><a href="#overview-of-top-drug-offenses-in-2021" id="toc-overview-of-top-drug-offenses-in-2021" class="nav-link" data-scroll-target="#overview-of-top-drug-offenses-in-2021"><strong>6.1 Overview of Top Drug Offenses in 2021</strong></a>
  <ul class="collapse">
  <li><a href="#filtering-data-for-2021" id="toc-filtering-data-for-2021" class="nav-link" data-scroll-target="#filtering-data-for-2021"><strong>6.1.1 Filtering Data for 2021</strong></a></li>
  </ul></li>
  <li><a href="#visualizing-drug-use-cases-with-different-classification-styles" id="toc-visualizing-drug-use-cases-with-different-classification-styles" class="nav-link" data-scroll-target="#visualizing-drug-use-cases-with-different-classification-styles"><strong>6.2 Visualizing Drug Use Cases with Different Classification Styles</strong></a>
  <ul class="collapse">
  <li><a href="#visualizing-suspects-in-drug-use-cases" id="toc-visualizing-suspects-in-drug-use-cases" class="nav-link" data-scroll-target="#visualizing-suspects-in-drug-use-cases"><strong>6.2.1 Visualizing Suspects in Drug Use Cases</strong></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#global-measures-of-spatial-autocorrelation" id="toc-global-measures-of-spatial-autocorrelation" class="nav-link" data-scroll-target="#global-measures-of-spatial-autocorrelation"><strong>7. Global Measures of Spatial Autocorrelation</strong></a>
  <ul class="collapse">
  <li><a href="#why-use-centroids-and-knn" id="toc-why-use-centroids-and-knn" class="nav-link" data-scroll-target="#why-use-centroids-and-knn">Why Use Centroids and KNN:</a></li>
  <li><a href="#global-morans-i-test" id="toc-global-morans-i-test" class="nav-link" data-scroll-target="#global-morans-i-test"><strong>7.1 Global Moran’s I Test</strong></a>
  <ul class="collapse">
  <li><a href="#global-morans-i-for-drug-use-cases" id="toc-global-morans-i-for-drug-use-cases" class="nav-link" data-scroll-target="#global-morans-i-for-drug-use-cases"><strong>7.1.1 Global Moran’s I for Drug Use Cases</strong></a></li>
  <li><a href="#global-morans-i-for-suspects-in-drug-use-cases" id="toc-global-morans-i-for-suspects-in-drug-use-cases" class="nav-link" data-scroll-target="#global-morans-i-for-suspects-in-drug-use-cases"><strong>7.1.2 Global Moran’s I for Suspects in Drug Use Cases</strong></a></li>
  </ul></li>
  <li><a href="#performing-global-morans-i-permutation-test" id="toc-performing-global-morans-i-permutation-test" class="nav-link" data-scroll-target="#performing-global-morans-i-permutation-test"><strong>7.2 Performing Global Moran’s I Permutation Test</strong></a>
  <ul class="collapse">
  <li><a href="#permutation-test-for-drug-use-cases" id="toc-permutation-test-for-drug-use-cases" class="nav-link" data-scroll-target="#permutation-test-for-drug-use-cases"><strong>7.2.1 Permutation Test for Drug Use Cases</strong></a></li>
  <li><a href="#permutation-test-for-suspects-in-drug-use-cases" id="toc-permutation-test-for-suspects-in-drug-use-cases" class="nav-link" data-scroll-target="#permutation-test-for-suspects-in-drug-use-cases"><strong>7.2.2 Permutation Test for Suspects in Drug Use Cases</strong></a></li>
  </ul></li>
  <li><a href="#global-gearys-c-test" id="toc-global-gearys-c-test" class="nav-link" data-scroll-target="#global-gearys-c-test"><strong>7.3 Global Geary’s C Test</strong></a>
  <ul class="collapse">
  <li><a href="#global-gearys-c-for-drug-use-cases" id="toc-global-gearys-c-for-drug-use-cases" class="nav-link" data-scroll-target="#global-gearys-c-for-drug-use-cases"><strong>7.3.1 Global Geary’s C for Drug Use Cases</strong></a></li>
  <li><a href="#global-gearys-c-for-suspects-in-drug-use-cases" id="toc-global-gearys-c-for-suspects-in-drug-use-cases" class="nav-link" data-scroll-target="#global-gearys-c-for-suspects-in-drug-use-cases"><strong>7.3.2 Global Geary’s C for Suspects in Drug Use Cases</strong></a></li>
  </ul></li>
  <li><a href="#performing-global-gearys-c-permutation-test" id="toc-performing-global-gearys-c-permutation-test" class="nav-link" data-scroll-target="#performing-global-gearys-c-permutation-test"><strong>7.4 Performing Global Geary’s C Permutation Test</strong></a>
  <ul class="collapse">
  <li><a href="#permutation-test-for-drug-use-cases-1" id="toc-permutation-test-for-drug-use-cases-1" class="nav-link" data-scroll-target="#permutation-test-for-drug-use-cases-1"><strong>7.4.1 Permutation Test for Drug Use Cases</strong></a></li>
  <li><a href="#permutation-test-for-suspects-in-drug-use-cases-1" id="toc-permutation-test-for-suspects-in-drug-use-cases-1" class="nav-link" data-scroll-target="#permutation-test-for-suspects-in-drug-use-cases-1"><strong>7.4.2 Permutation Test for Suspects in Drug Use Cases</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-Home Exercise 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Xu Haiyang </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 23, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 13, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="setting-the-scene" class="level1">
<h1><strong>1. Setting the Scene</strong></h1>
<p>Drug abuse is associated with significant negative health, financial and social consequences. Yet, illicit drug consumption remains highly prevalent and continues to be a growing problem worldwide. In 2021, 1 in 17 people aged 15–64 in the world had used a drug in the past 12 months. Notwithstanding population growth, the estimated number of drug users grew from 240 million in 2011 to 296 million in 2021.</p>
<p>The geopolitics of Thailand which is near the <a href="https://en.wikipedia.org/wiki/Golden_Triangle_(Southeast_Asia)">Golden Triangle</a> of Indochina, the largest drug production site in Asia, and the constant transportation infrastructure development made Thailand became market and transit routes for drug trafficking to the third countries.</p>
<p>In Thailand, drug abuse is one of the major social issue. There are about 2.7 million youths using drugs in Thailand. Among youths aged between 15 and 19 years, there are about 300,000 who have needs for drug treatment. Most of Thai youths involved with drugs are vocational-school students, which nearly doubles in number compared to secondary-school students.</p>
<p>Figure below shows geographic distribution of drug use cases by province and by year.</p>
<p><img src="images/clipboard-1584006491.png" class="img-fluid"></p>
<section id="objectives" class="level2">
<h2 class="anchored" data-anchor-id="objectives"><strong>1.1 Objectives</strong></h2>
<p>As a curious geospatial analytics green horn, you are interested to discover:</p>
<ul>
<li><p>if the key indicators of drug abuse of Thailand are independent from space.</p></li>
<li><p>If the indicators of drug abuse is indeed spatial dependent, then, you would like to detect where are the clusters and outliers, and the hotspots.</p></li>
<li><p>Last but not least, you are also interested to investigate how the observation above evolve over time.</p></li>
</ul>
</section>
<section id="the-task" class="level2">
<h2 class="anchored" data-anchor-id="the-task"><strong>1.2 The Task</strong></h2>
<p>The specific tasks of this take-home exercise are as follows:</p>
<ul>
<li><p>Using appropriate function of <strong>sf</strong> and <strong>tidyverse</strong>, preparing the following geospatial data layer:</p>
<ul>
<li><p>a study area layer in sf polygon features. It must be at <a href="https://en.wikipedia.org/wiki/Provinces_of_Thailand">province level</a> (including Bangkok) of Thailand.</p></li>
<li><p>a drug abuse indicators layer within the study area in sf polygon features.</p></li>
</ul></li>
<li><p>Using the extracted data, perform global spatial autocorrelation analysis by using <a href="https://is415-gaa-tskam.netlify.app/in-class_ex/in-class_ex05/in-class_ex05-glsa">sfdep methods</a>.</p></li>
<li><p>Using the extracted data, perform local spatial autocorrelation analysis by using <a href="https://r4gdsa.netlify.app/chap10.html">sfdep methods</a>.</p></li>
<li><p>Describe the spatial patterns revealed by the analysis above.</p></li>
</ul>
</section>
</section>
<section id="literature-review" class="level1">
<h1><strong>2. Literature Review</strong></h1>
<section id="spatial-autocorrelation" class="level2">
<h2 class="anchored" data-anchor-id="spatial-autocorrelation"><strong>2.1 Spatial Autocorrelation</strong></h2>
<p>I tried to understand the concept of <strong>spatial autocorrelation</strong>, which is based on Tobler’s First Law of Geography: “Everything is related to everything else, but near things are more related than distant things” (Tobler, 1970). Spatial autocorrelation measures how much nearby spatial data points are similar or dissimilar to each other. It helps to analyze the extent of clustering or dispersion of spatial phenomena, offering insights into whether specific regions experience higher or lower-than-expected event concentrations. For example, in this context, spatial autocorrelation can reveal whether drug offenses in Thailand are clustered in particular provinces or dispersed across the country.</p>
</section>
<section id="emerging-hotspot-analysis" class="level2">
<h2 class="anchored" data-anchor-id="emerging-hotspot-analysis"><strong>2.2 Emerging Hotspot Analysis</strong></h2>
<p>I tried to explore the concept of <strong>emerging hotspot analysis</strong>, which identifies areas with a higher concentration of events than expected in a random distribution. Initially rooted in point distribution studies, it’s particularly relevant for detecting trends and patterns over time. In the case of drug offenses in Thailand, this analysis can be used to track changes in the intensity of offenses, identify newly emerging hotspots, or monitor areas where offenses are consistently high. By identifying these hotspots, policymakers can better allocate resources to address issues in specific regions.</p>
</section>
</section>
<section id="importing-packages" class="level1">
<h1><strong>3. Importing Packages</strong></h1>
<p>I tried to import the necessary R packages using the <code>pacman::p_load()</code> function, which is an efficient way to load multiple libraries in R. These packages include:</p>
<ul>
<li><p><strong>sf</strong>: for handling spatial data</p></li>
<li><p><strong>dplyr</strong> and <strong>tidyverse</strong>: for data manipulation</p></li>
<li><p><strong>ggplot2</strong>: for data visualization</p></li>
<li><p><strong>sfdep</strong>: for spatial dependency and autocorrelation analysis</p></li>
<li><p><strong>tmap</strong>: for creating thematic maps</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, dplyr, readr, ggplot2, sfdep, tmap, tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-datasets-to-r-environment" class="level1">
<h1><strong>4. Importing Datasets to R Environment</strong></h1>
<p>I tried to load two datasets into the R environment:</p>
<ol type="1">
<li><p><strong>Drug offenses dataset</strong>: This contains data on drug offenses in Thailand from 2017-2022.</p></li>
<li><p><strong>Thai geographic dataset</strong>: This shapefile contains the geographic boundaries of Thailand’s provinces.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/thai_drug_offenses_2017_2022.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 7392 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): types_of_drug_offenses, province_th, province_en
dbl (2): fiscal_year, no_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>thai_geo <span class="ot">=</span> <span class="fu">st_read</span>(<span class="at">dsn =</span> <span class="st">"data/tha_adm_rtsd_itos_20210121"</span>, <span class="at">layer =</span> <span class="st">"tha_admbnda_adm1_rtsd_20220121"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `tha_admbnda_adm1_rtsd_20220121' from data source 
  `C:\EasonXu-HY99\IS415\Take-Home_Ex\Take-Home_Ex02\data\tha_adm_rtsd_itos_20210121' 
  using driver `ESRI Shapefile'
Simple feature collection with 77 features and 16 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>To ensure the coordinate reference system (CRS) of the geographic dataset is consistent, I used the following code to inspect it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(thai_geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<section id="visualizing-the-map-of-thailands-provinces" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-the-map-of-thailands-provinces"><strong>4.1 Visualizing the Map of Thailand’s Provinces</strong></h2>
<p>I tried to visualize the provinces of Thailand using the <code>tmap</code> package. The plot shows the boundaries of all provinces with simple white fills and black borders, creating a clean visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(thai_geo) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="fl">0.3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title =</span> <span class="st">"Provinces of Thailand"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="dv">1</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.position =</span> <span class="st">"center"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.show =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="projecting-and-adding-geometric-attributes" class="level2">
<h2 class="anchored" data-anchor-id="projecting-and-adding-geometric-attributes"><strong>4.2 Projecting and Adding Geometric Attributes</strong></h2>
<p>I tried to reproject the geographic dataset into the UTM zone 47N CRS (<code>EPSG: 32647</code>) to make spatial calculations more accurate. I also added two new geometric attributes: <code>Shape_Area</code> (area of each province) and <code>Shape_Length</code> (perimeter).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>thai_geo_projected <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(thai_geo, <span class="at">crs =</span> <span class="dv">32647</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>thai_geo_projected <span class="ot">&lt;-</span> thai_geo_projected <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Shape_Area =</span> <span class="fu">st_area</span>(geometry),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Shape_leng =</span> <span class="fu">st_length</span>(<span class="fu">st_cast</span>(geometry, <span class="st">"MULTILINESTRING"</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level1">
<h1><strong>5. Data Preprocessing</strong></h1>
<p>I tried to clean and prepare the drug offenses dataset by correcting misspelled province names. The <code>recode()</code> function is used to ensure consistency between the province names in both datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Drug <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/thai_drug_offenses_2017_2022.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">province_en =</span> <span class="fu">recode</span>(province_en, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"buogkan"</span> <span class="ot">=</span> <span class="st">"Bueng Kan"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Loburi"</span> <span class="ot">=</span> <span class="st">"Lop Buri"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 7392 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): types_of_drug_offenses, province_th, province_en
dbl (2): fiscal_year, no_cases

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Next, I merged the drug offense data with the geographic dataset by matching provinces. The final dataset includes geographic information, offense types, and the number of cases per province.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>merged_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  thai_geo_projected,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  Drug,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ADM1_EN"</span> <span class="ot">=</span> <span class="st">"province_en"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    ADM1_EN,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    ADM1_PCODE,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    Shape_leng,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    Shape_Area,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    fiscal_year,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    types_of_drug_offenses,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    no_cases,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    geometry</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Drug, thai_geo, thai_geo_projected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exploring-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-data"><strong>5.1 Exploring the Data</strong></h2>
<p>I tried to explore the unique fiscal years and offense types in the merged dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>years_list <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(fiscal_year) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(years_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2017 2018 2019 2020 2021 2022</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>offense_types_list <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(offense_types_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "conspiracy_cases"                                      
 [2] "drug_use_cases"                                        
 [3] "export_cases"                                          
 [4] "import_cases"                                          
 [5] "possession_cases"                                      
 [6] "possession_with_intent_to_distribute_cases"            
 [7] "production_cases"                                      
 [8] "suspects_in_conspiracy_cases"                          
 [9] "suspects_in_drug_use_cases"                            
[10] "suspects_in_export_cases"                              
[11] "suspects_in_import_cases"                              
[12] "suspects_in_possession_cases"                          
[13] "suspects_in_possession_with_intent_to_distribute_cases"
[14] "suspects_in_production_cases"                          
[15] "suspects_in_trafficking_cases"                         
[16] "trafficking_cases"                                     </code></pre>
</div>
</div>
</section>
<section id="summarizing-and-visualizing-drug-offense-data" class="level2">
<h2 class="anchored" data-anchor-id="summarizing-and-visualizing-drug-offense-data"><strong>5.2 Summarizing and Visualizing Drug Offense Data</strong></h2>
<p>I tried to summarize the number of cases for each type of drug offense between 2017-2022 and create a bar plot using <code>ggplot2</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>offense_summary <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_cases))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># View the summary</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(offense_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 16 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 325178.8 ymin: 620860.6 xmax: 1213656 ymax: 2263241
Projected CRS: WGS 84 / UTM zone 47N
# A tibble: 16 × 3
   types_of_drug_offenses                  total_cases                  geometry
   &lt;chr&gt;                                         &lt;dbl&gt;        &lt;MULTIPOLYGON [m]&gt;
 1 suspects_in_drug_use_cases                   930768 (((424359.7 827043.4, 42…
 2 drug_use_cases                               915529 (((424359.7 827043.4, 42…
 3 suspects_in_possession_cases                 566999 (((424359.7 827043.4, 42…
 4 possession_cases                             538893 (((424359.7 827043.4, 42…
 5 suspects_in_possession_with_intent_to_…      386946 (((424359.7 827043.4, 42…
 6 possession_with_intent_to_distribute_c…      341283 (((424359.7 827043.4, 42…
 7 suspects_in_trafficking_cases                 79997 (((424359.7 827043.4, 42…
 8 trafficking_cases                             68379 (((424359.7 827043.4, 42…
 9 suspects_in_production_cases                  66247 (((424359.7 827043.4, 42…
10 production_cases                              56892 (((424359.7 827043.4, 42…
11 suspects_in_conspiracy_cases                   2332 (((424359.7 827043.4, 42…
12 suspects_in_import_cases                       1066 (((424359.7 827043.4, 42…
13 conspiracy_cases                                920 (((424359.7 827043.4, 42…
14 import_cases                                    860 (((424359.7 827043.4, 42…
15 suspects_in_export_cases                        102 (((424359.7 827043.4, 42…
16 export_cases                                     84 (((424359.7 827043.4, 42…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(offense_summary, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(types_of_drug_offenses, total_cases), <span class="at">y =</span> total_cases)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Types of Drug Offenses"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Cases (2017-2022)"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Total Drug Offense Cases by Type in Thailand (2017-2022)"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="trends-for-top-drug-offenses" class="level2">
<h2 class="anchored" data-anchor-id="trends-for-top-drug-offenses"><strong>5.3 Trends for Top Drug Offenses</strong></h2>
<p>I tried to identify the top two drug offense types and analyzed their trends over the years. This helps in identifying the offenses that need the most attention.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>top_offenses <span class="ot">&lt;-</span> offense_summary <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">2</span>, total_cases) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(types_of_drug_offenses)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(top_offenses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "suspects_in_drug_use_cases" "drug_use_cases"            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>top_offenses_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(types_of_drug_offenses <span class="sc">%in%</span> top_offenses)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>yearly_offense_summary <span class="ot">&lt;-</span> top_offenses_data <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fiscal_year, types_of_drug_offenses) <span class="sc">%&gt;%</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_cases =</span> <span class="fu">sum</span>(no_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'fiscal_year'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(yearly_offense_summary, <span class="fu">aes</span>(<span class="at">x =</span> fiscal_year, <span class="at">y =</span> total_cases, <span class="at">color =</span> types_of_drug_offenses, <span class="at">group =</span> types_of_drug_offenses)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fiscal Year"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Cases"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Trends of Top 2 Drug Offenses in Thailand (2017-2022)"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Offense Type"</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-wrangling" class="level1">
<h1><strong>6. Data Wrangling</strong></h1>
<section id="overview-of-top-drug-offenses-in-2021" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-top-drug-offenses-in-2021"><strong>6.1 Overview of Top Drug Offenses in 2021</strong></h2>
<p>I tried to analyze the trends in drug offenses for the year 2021, which marks a significant peak in the top two drug offenses throughout the 6-year period (2017-2022). From the graph, we can observe that 2021 witnessed the highest number of drug offense cases, particularly for <strong>drug use cases</strong> and <strong>suspects in drug use cases</strong>.</p>
<section id="filtering-data-for-2021" class="level3">
<h3 class="anchored" data-anchor-id="filtering-data-for-2021"><strong>6.1.1 Filtering Data for 2021</strong></h3>
<p>To focus on the year 2021, I filtered the dataset to extract the data related to <strong>drug use cases</strong> and <strong>suspects in drug use cases</strong>. This allows for a more detailed analysis of these two offense types for that year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>drug_use_cases_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="st">"2021"</span>, types_of_drug_offenses <span class="sc">==</span> <span class="st">"drug_use_cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>suspects_in_drug_use_cases_data <span class="ot">&lt;-</span> merged_data <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fiscal_year <span class="sc">==</span> <span class="st">"2021"</span>, types_of_drug_offenses <span class="sc">==</span> <span class="st">"suspects_in_drug_use_cases"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(merged_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualizing-drug-use-cases-with-different-classification-styles" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-drug-use-cases-with-different-classification-styles"><strong>6.2 Visualizing Drug Use Cases with Different Classification Styles</strong></h2>
<p>I tried to visualize the <strong>drug use cases</strong> offense type using two different classification styles: <strong>Equal Interval</strong> and <strong>Quantile</strong> classification. These styles offer different insights into how drug use cases are distributed across the provinces of Thailand.</p>
<ol type="1">
<li><p><strong>Equal Interval Classification</strong> divides the data range into equal-sized intervals, which can help highlight the absolute differences between provinces.</p></li>
<li><p><strong>Quantile Classification</strong> divides the data into quantiles, where each class contains an equal number of provinces, making it useful for identifying relative concentrations.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>equal_drug <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_use_cases_data) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"no_cases"</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal Interval Classification: drug use cases"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>quantile_drug <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(drug_use_cases_data) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"no_cases"</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Quantile Classification: drug use cases"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">tmap_arrange</span>(equal_drug, quantile_drug, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="visualizing-suspects-in-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-suspects-in-drug-use-cases"><strong>6.2.1 Visualizing Suspects in Drug Use Cases</strong></h3>
<p>Similarly, I tried to visualize the distribution of <strong>suspects in drug use cases</strong> using both <strong>Equal Interval</strong> and <strong>Quantile Classification</strong>. This comparison allows for a better understanding of how the distribution of suspects differs from the actual drug use cases across provinces.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">"plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>tmap mode set to plotting</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>equal_suspects <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(suspects_in_drug_use_cases_data) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"no_cases"</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">style =</span> <span class="st">"equal"</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Equal Interval Classification: suspects in drug use cases"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>quantile_suspects <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(suspects_in_drug_use_cases_data) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">"no_cases"</span>, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">style =</span> <span class="st">"quantile"</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">"Quantile Classification: suspects in drug use cases"</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">tmap_arrange</span>(equal_suspects, quantile_suspects, <span class="at">asp =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="global-measures-of-spatial-autocorrelation" class="level1">
<h1><strong>7. Global Measures of Spatial Autocorrelation</strong></h1>
<p>To examine whether provinces with similar values for drug use cases are clustered together, I tried to compute <strong>contiguity spatial weights</strong> using the <strong>Queen’s contiguity method</strong>. This method defines neighboring provinces based on shared boundaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>neighbors_drug_use <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(drug_use_cases_data, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(neighbors_drug_use)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
14 with 1 link
2 most connected regions:
29 51 with 9 links</code></pre>
</div>
</div>
<p>For further analysis, I also calculated the <strong>centroids</strong> of each province to apply <strong>k-nearest neighbors (k=5)</strong>, which helps explore relationships between provinces based on proximity.</p>
<section id="why-use-centroids-and-knn" class="level3">
<h3 class="anchored" data-anchor-id="why-use-centroids-and-knn">Why Use Centroids and KNN:</h3>
<ol type="1">
<li><p><strong>One region with no links</strong>: The summary shows <strong>1 region (region 67)</strong> has no neighbors (0 links). This suggests that, using contiguity-based methods alone, some regions were isolated, preventing them from being included in the spatial analysis.</p></li>
<li><p><strong>Disjoint connected subgraphs</strong>: The presence of <strong>disjoint subgraphs</strong> (separate groups of connected regions) means the spatial connectivity is fragmented, further justifying the need for <strong>KNN</strong> to ensure that all regions have neighbors.</p></li>
<li><p><strong>KNN ensures connectivity</strong>: By using <strong>centroids</strong> and calculating <strong>KNN</strong>, I ensure that every region (including isolated ones) has neighbors, maintaining the integrity of the spatial analysis. KNN allows me to connect regions even if they are not physically contiguous but spatially close based on distance.</p></li>
<li><p><strong>Balanced links</strong>: KNN balances the number of links per region. In this case, the <strong>average number of links is 4.57</strong>, ensuring more consistent neighbor counts across regions and improving the reliability of the spatial analysis.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>centroids_drug_use <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(drug_use_cases_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>neighbors_drug_use <span class="ot">&lt;-</span> <span class="fu">st_knn</span>(centroids_drug_use, <span class="at">k =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I tried to compute the <strong>spatial weights matrix</strong> using the contiguity-based neighbors. The spatial weights are calculated using the “W” style, which standardizes the weights by the sum of all neighbors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>weights_drug_use <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(neighbors_drug_use, <span class="at">style =</span> <span class="st">"W"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, I tried to compute the spatial relationships for <strong>suspects in drug use cases</strong>. This analysis helps determine whether provinces with higher numbers of suspects are spatially clustered.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>neighbors_suspect <span class="ot">&lt;-</span> <span class="fu">st_contiguity</span>(suspects_in_drug_use_cases_data, <span class="at">queen =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): some observations have no neighbours;
if this seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in spdep::poly2nb(geometry, queen = queen, ...): neighbour object has 2 sub-graphs;
if this sub-graph count seems unexpected, try increasing the snap argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(neighbors_suspect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Neighbour list object:
Number of regions: 77 
Number of nonzero links: 352 
Percentage nonzero weights: 5.93692 
Average number of links: 4.571429 
1 region with no links:
67
2 disjoint connected subgraphs
Link number distribution:

 0  1  2  3  4  5  6  7  8  9 
 1  1  5 17 15 17 10  5  4  2 
1 least connected region:
14 with 1 link
2 most connected regions:
29 51 with 9 links</code></pre>
</div>
</div>
<p>I applied the same k-nearest neighbors approach to this dataset as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>centroids_suspects <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(suspects_in_drug_use_cases_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: st_centroid assumes attributes are constant over geometries</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>neighbors_suspect <span class="ot">&lt;-</span> <span class="fu">st_knn</span>(centroids_suspects, <span class="at">k =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, I calculated the spatial weights for the <strong>suspects in drug use cases</strong> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>weights_suspect <span class="ot">&lt;-</span> <span class="fu">st_weights</span>(neighbors_suspect, <span class="at">style =</span> <span class="st">"W"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="global-morans-i-test" class="level2">
<h2 class="anchored" data-anchor-id="global-morans-i-test"><strong>7.1 Global Moran’s I Test</strong></h2>
<p>I tried to perform the <strong>Global Moran’s I test</strong>, which is a measure of global spatial autocorrelation. It evaluates whether the spatial distribution of drug use cases and suspects in drug use cases shows a pattern that is significantly clustered or dispersed compared to a random distribution.</p>
<section id="global-morans-i-for-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="global-morans-i-for-drug-use-cases"><strong>7.1.1 Global Moran’s I for Drug Use Cases</strong></h3>
<p>First, I calculated the Global Moran’s I statistic for <strong>drug use cases</strong> in 2021 using the contiguity-based neighbors and weights previously computed. This statistic helps to identify the level of spatial autocorrelation for drug use cases across Thai provinces.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>moran_drug_use_result <span class="ot">&lt;-</span> <span class="fu">global_moran</span>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  neighbors_drug_use,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  weights_drug_use</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_drug_use_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$I
[1] 0.1501002

$K
[1] 4.710498</code></pre>
</div>
</div>
<p>Next, I conducted a <strong>Moran’s I significance test</strong> to evaluate whether the observed spatial autocorrelation is statistically significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_moran_test</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  neighbors_drug_use,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  weights_drug_use,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.5631, p-value = 0.005187
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.150100162      -0.013157895       0.004057091 </code></pre>
</div>
</div>
</section>
<section id="global-morans-i-for-suspects-in-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="global-morans-i-for-suspects-in-drug-use-cases"><strong>7.1.2 Global Moran’s I for Suspects in Drug Use Cases</strong></h3>
<p>Similarly, I calculated the Global Moran’s I for <strong>suspects in drug use cases</strong> to assess whether there is a similar pattern of spatial clustering.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>moran_suspect_result <span class="ot">&lt;-</span> <span class="fu">global_moran</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  suspects_in_drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  neighbors_suspect,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  weights_suspect</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(moran_suspect_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$I
[1] 0.1495297

$K
[1] 4.669362</code></pre>
</div>
</div>
<p>I also performed a significance test for Moran’s I on the suspects dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_moran_test</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  suspects_in_drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  neighbors_suspect,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  weights_suspect,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.policy =</span> <span class="cn">TRUE</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  x  
weights: listw    

Moran I statistic standard deviate = 2.5534, p-value = 0.005334
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
      0.149529690      -0.013157895       0.004059449 </code></pre>
</div>
</div>
</section>
</section>
<section id="performing-global-morans-i-permutation-test" class="level2">
<h2 class="anchored" data-anchor-id="performing-global-morans-i-permutation-test"><strong>7.2 Performing Global Moran’s I Permutation Test</strong></h2>
<p>To further assess the significance of Moran’s I statistic, I tried to perform a <strong>permutation test</strong> with 999 simulations. This test creates a distribution of Moran’s I values under the assumption of spatial randomness, and then compares the observed value to this distribution.</p>
<section id="permutation-test-for-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="permutation-test-for-drug-use-cases"><strong>7.2.1 Permutation Test for Drug Use Cases</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>gmoran_drug_use <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  neighbors_drug_use,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  weights_drug_use,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>gmoran_drug_use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.1501, observed rank = 987, p-value = 0.026
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>The histogram below visualizes the distribution of the permuted Moran’s I statistics, with the observed value marked in red:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(gmoran_drug_use<span class="sc">$</span>res, <span class="at">main=</span><span class="st">"Histogram of Global Moran's I Monte-Carlo Simulation Results (Drug Use Cases)"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> gmoran_drug_use<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the <strong>Global Moran’s I Monte Carlo Simulation</strong> results depicted in the histogram, I can see the distribution of simulated Moran’s I values under the null hypothesis of no spatial autocorrelation. The observed Moran’s I value is marked by the <strong>red vertical line</strong>. From the plot, it is clear that the observed Moran’s I value (around <strong>0.15</strong>) is positioned to the right of the bulk of the simulated values, which center around <strong>0</strong>. This indicates that the observed value is significantly higher than most of the random simulations, further supporting the presence of <strong>positive spatial autocorrelation</strong> in the data. The shape of the histogram shows the range of possible Moran’s I values under the assumption of spatial randomness, and the positioning of the observed value outside this range confirms the statistical significance of the spatial clustering observed in the previous test. This visual representation reinforces the conclusion that the spatial patterns in the data are not random but exhibit significant spatial dependence.</p>
</section>
<section id="permutation-test-for-suspects-in-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="permutation-test-for-suspects-in-drug-use-cases"><strong>7.2.2 Permutation Test for Suspects in Drug Use Cases</strong></h3>
<p>The same permutation test was performed for <strong>suspects in drug use cases</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>gmoran_suspect <span class="ot">&lt;-</span> <span class="fu">global_moran_perm</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  suspects_in_drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  neighbors_suspect,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  weights_suspect,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>gmoran_suspect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Moran I

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.14953, observed rank = 987, p-value = 0.026
alternative hypothesis: two.sided</code></pre>
</div>
</div>
<p>The histogram of results, with the observed Moran’s I statistic marked, helps assess the significance of spatial clustering:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(gmoran_suspect<span class="sc">$</span>res, <span class="at">main=</span><span class="st">"Histogram of Global Moran's I Monte-Carlo Simulation Results (Suspects in Drug Use Cases)"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> gmoran_suspect<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this updated <strong>Global Moran’s I Monte Carlo Simulation</strong> result, I observed a histogram displaying the distribution of simulated Moran’s I values under the assumption of spatial randomness. The <strong>red vertical line</strong> represents the observed Moran’s I statistic, which appears around <strong>0.15</strong> and is noticeably positioned to the right of the majority of the simulated Moran’s I values, which cluster around <strong>0</strong>. This demonstrates that the observed Moran’s I is significantly greater than the random expectations, reinforcing the presence of <strong>positive spatial autocorrelation</strong> in the data. The fact that the observed value lies far outside the bulk of the Monte Carlo results supports the earlier finding that the spatial pattern in the data is not due to chance, but rather, exhibits a statistically significant spatial clustering.</p>
</section>
</section>
<section id="global-gearys-c-test" class="level2">
<h2 class="anchored" data-anchor-id="global-gearys-c-test"><strong>7.3 Global Geary’s C Test</strong></h2>
<p>I tried to perform the <strong>Global Geary’s C test</strong>, another global measure of spatial autocorrelation. Unlike Moran’s I, which focuses on global spatial patterns, Geary’s C is more sensitive to local differences. It can highlight differences between individual provinces and their neighbors in terms of drug offense counts.</p>
<section id="global-gearys-c-for-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="global-gearys-c-for-drug-use-cases"><strong>7.3.1 Global Geary’s C for Drug Use Cases</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_c_test</span>(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  neighbors_drug_use,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  weights_drug_use)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 1.5296, p-value = 0.06306
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
       0.88246518        1.00000000        0.00590431 </code></pre>
</div>
</div>
</section>
<section id="global-gearys-c-for-suspects-in-drug-use-cases" class="level3">
<h3 class="anchored" data-anchor-id="global-gearys-c-for-suspects-in-drug-use-cases"><strong>7.3.2 Global Geary’s C for Suspects in Drug Use Cases</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">global_c_test</span>(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  suspects_in_drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  neighbors_suspect,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  weights_suspect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Geary C test under randomisation

data:  x 
weights: listw   

Geary C statistic standard deviate = 1.5088, p-value = 0.06568
alternative hypothesis: Expectation greater than statistic
sample estimates:
Geary C statistic       Expectation          Variance 
      0.884258244       1.000000000       0.005884967 </code></pre>
</div>
</div>
</section>
</section>
<section id="performing-global-gearys-c-permutation-test" class="level2">
<h2 class="anchored" data-anchor-id="performing-global-gearys-c-permutation-test"><strong>7.4 Performing Global Geary’s C Permutation Test</strong></h2>
<p>Similar to Moran’s I, I also tried to conduct a <strong>permutation test for Global Geary’s C</strong>. This Monte Carlo simulation helps assess the significance of the observed Geary’s C statistic under the assumption of spatial randomness.</p>
<section id="permutation-test-for-drug-use-cases-1" class="level3">
<h3 class="anchored" data-anchor-id="permutation-test-for-drug-use-cases-1"><strong>7.4.1 Permutation Test for Drug Use Cases</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>bperm_drug_use <span class="ot">&lt;-</span> <span class="fu">global_c_perm</span>(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  neighbors_drug_use,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  weights_drug_use,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>bperm_drug_use</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.88247, observed rank = 67, p-value = 0.067
alternative hypothesis: greater</code></pre>
</div>
</div>
<p>The histogram of the permuted results shows how the observed statistic compares to the simulated ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm_drug_use<span class="sc">$</span>res, <span class="at">main=</span><span class="st">"Histogram of Global Geary's C Monte-Carlo Simulation Results (Drug Use cases)"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> bperm_drug_use<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the <strong>Global Geary’s C Monte Carlo Simulation</strong> result shown in the histogram, I observed the distribution of simulated Geary’s C values under the null hypothesis of spatial randomness. The <strong>red vertical line</strong> marks the observed Geary’s C statistic, which is around <strong>0.9</strong>, while most of the simulated values are centered around <strong>1.0</strong>.</p>
<p>Geary’s C values typically range from <strong>0 to 2</strong>:</p>
<ul>
<li><p><strong>C &lt; 1</strong> indicates positive spatial autocorrelation (i.e., nearby regions are similar).</p></li>
<li><p><strong>C &gt; 1</strong> suggests negative spatial autocorrelation (i.e., nearby regions are dissimilar).</p></li>
</ul>
<p>Since the observed Geary’s C value is less than <strong>1.0</strong>, it suggests <strong>positive spatial autocorrelation</strong>, meaning that regions close to each other tend to have similar values. Additionally, the position of the observed Geary’s C value outside the main bulk of the simulated distribution confirms that this spatial autocorrelation is statistically significant. Thus, there is evidence of clustering in the data, with similar values tending to be geographically close to one another.</p>
</section>
<section id="permutation-test-for-suspects-in-drug-use-cases-1" class="level3">
<h3 class="anchored" data-anchor-id="permutation-test-for-suspects-in-drug-use-cases-1"><strong>7.4.2 Permutation Test for Suspects in Drug Use Cases</strong></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>bperm_suspect <span class="ot">&lt;-</span> <span class="fu">global_c_perm</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  suspects_in_drug_use_cases_data<span class="sc">$</span>no_cases,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  neighbors_suspect,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  weights_suspect,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">nsim =</span> <span class="dv">999</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>bperm_suspect</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Monte-Carlo simulation of Geary C

data:  x 
weights: listw  
number of simulations + 1: 1000 

statistic = 0.88426, observed rank = 73, p-value = 0.073
alternative hypothesis: greater</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bperm_suspect<span class="sc">$</span>res, <span class="at">main=</span><span class="st">"Histogram of Global Geary's C Monte-Carlo Simulation Results (Suspects in Drug Use cases)"</span>, <span class="at">xlab=</span><span class="st">"Monte-Carlo Results"</span>, <span class="at">ylab=</span><span class="st">"Frequency"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> bperm_suspect<span class="sc">$</span>statistic, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-Home_Ex02_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this <strong>Global Geary’s C Monte Carlo Simulation</strong> result, I observed the distribution of simulated Geary’s C values, with the <strong>red vertical line</strong> representing the observed Geary’s C statistic, which is approximately <strong>0.9</strong>. The bulk of the simulated values are centered around <strong>1.0</strong>, which is the expected value under the assumption of no spatial autocorrelation.</p>
<ul>
<li><p>A <strong>Geary’s C value less than 1</strong> (like the observed <strong>0.9</strong>) suggests <strong>positive spatial autocorrelation</strong>, meaning nearby regions have similar values.</p></li>
<li><p>The fact that the observed value lies outside the majority of the simulated results indicates that the spatial clustering of similar values is statistically significant and unlikely to have occurred by chance.</p></li>
</ul>
<p>Thus, the data exhibit significant spatial autocorrelation, where regions close to each other are more likely to have similar values, supporting the hypothesis of spatial dependence in the dataset.</p>
<p><a href="Take-Home_Ex02_2.html">Continue to Page 2</a></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>